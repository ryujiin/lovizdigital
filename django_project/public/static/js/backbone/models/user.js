define(["underscore","backbone","storage","../views/app/bloque_ajax"],function(e,r,o,n){"use strict";var a=r.Model.extend({url:"/api/user/perfil/",initialize:function(){this.buscar_user()},defaults:{fristname:"Anonimo"},validate:function(){},parse:function(e){return e},buscar_user:function(){this.fetch().done(function(){})},logout_user:function(){localStorage.removeItem("token_user"),window.location="/"},ingresar_user:function(e,o,a){var i=this,s=new n;$.post("/login/",{username:e,password:o}).done(function(e){0!==e.id?(i.buscar_user(),"pedido"===a.model.name?a.model.set("paso_actual",2):(a.loader.remove(),r.history.navigate("/usuario/perfil/",{trigger:!0}))):a.error_login()}).fail(function(){a.error_login()}).always(function(){s.remove()})},crear_user:function(e,r,o,n,a){var i=this,s=new ProgrecionBar;i.email=e,i.pass=r,$.post("http://localhost:8000/ajax/crear/",{username:e,password:r,nombre:o,apellido:n}).done(function(e){e.creado===!0&&i.ingresar_user(i.email,i.pass)}).fail(function(){a.error_crear()}).always(function(){s.remove()})}}),i=new a;return i});