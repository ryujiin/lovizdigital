define(["jquery","underscore","backbone","swig","stripe"],function(e,a,t,s,r){"use strict";var n=t.View.extend({template:s.compile(e("#pago_tarjeta_tlp").html()),tagName:"div",id:"",className:"",events:{"keydown #number":"ver_numero","keyup #number":"contar_numero","blur input":"get_datos","blur select":"get_datos"},initialize:function(){this.render()},render:function(){this.$el.html(this.template(this.model.toJSON()))},ver_numero:function(e){return e.keyCode>=48&&e.keyCode<=57||8==e.keyCode?!0:!1},get_datos:function(e){{var a=e.target.value,t="."+e.target.dataset.contenedor;this.validar_vacio(a,t)}},validar_vacio:function(e,a){var t=this.$(a+" .error");return t.empty(),""===e?(this.$(a).addClass("has-error").removeClass("has-success"),t.append('<p class="text-danger">Este campo es Requerido *</p>'),!1):(this.$(a).addClass("has-success").removeClass("has-error"),!0)},contar_numero:function(){var a=this.$("#number").val().length,t=e("."+this.$("#number").data("contenedor"));a>=16?t.addClass("has-success"):t.removeClass("has-success")},verificar:function(){this.verificar_inputs(),this.enviar_form()},verificar_inputs:function(){this.$("input").each(function(a,t){0===t.value.length?e("."+t.dataset.contenedor).addClass("has-error"):e("."+t.dataset.contenedor).addClass("has-success").removeClass("has-error")}),this.$("select").each(function(a,t){0===t.value.length?e("."+t.dataset.contenedor).addClass("has-error"):e("."+t.dataset.contenedor).addClass("has-success").removeClass("has-error")})},enviar_form:function(){var e=this.$("#name").val(),a=this.$("#number").val(),t=this.$("#mes").val(),s=this.$("#year").val(),r=this.$("#cvc").val();e&&a&&t&&s&&r&&this.pago_Stripe(e,a,t,s,r)},pago_Stripe:function(a,t,s,n,o){var i="pk_test_1dnWop5afJiTtiGPo2GsJsa4";r.setPublishableKey(i);var d=function(a,t){var s=e("#pagar_tarjeta");if(t.error)s.find(".payment-errors").text(t.error.message),s.find("button").prop("disabled",!1);else{var r=t.id;s.append(e('<input type="hidden" name="stripeToken" />').val(r)),e.post("/pago/stripe/",{stripeToken:r,carro:e("#carro_pago").val()}).done(function(e){"paid"===e.status&&(window.location="/felicidades/"+e.pedido+"/")})}},c={number:t,cvc:o,exp_month:s,exp_year:n};r.card.createToken(c,d)}});return n});