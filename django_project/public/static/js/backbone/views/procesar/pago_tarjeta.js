define(["jquery","underscore","backbone","swig","stripe","carro"],function(e,a,t,r,s,n){"use strict";var i=t.View.extend({template:r.compile(e("#pago_tarjeta_tlp").html()),tagName:"div",id:"",className:"",events:{"keydown #number":"ver_numero","keyup #number":"contar_numero","blur input":"get_datos","blur select":"get_datos"},initialize:function(){this.render()},render:function(){var a=this;e.get("/get_stripe_key/").done(function(e){a.stripe_key=e.key,a.$el.html(a.template(a.model.toJSON()))})},ver_numero:function(e){return e.keyCode>=48&&e.keyCode<=57||8==e.keyCode?!0:!1},get_datos:function(e){{var a=e.target.value,t="."+e.target.dataset.contenedor;this.validar_vacio(a,t)}},validar_vacio:function(e,a){var t=this.$(a+" .error");return t.empty(),""===e?(this.$(a).addClass("has-error").removeClass("has-success"),t.append('<p class="text-danger">Este campo es Requerido *</p>'),!1):(this.$(a).addClass("has-success").removeClass("has-error"),!0)},contar_numero:function(){var a=this.$("#number").val().length,t=e("."+this.$("#number").data("contenedor"));a>=16?t.addClass("has-success"):t.removeClass("has-success")},verificar:function(){this.verificar_inputs(),this.enviar_form()},verificar_inputs:function(){this.$("input").each(function(a,t){0===t.value.length?e("."+t.dataset.contenedor).addClass("has-error"):e("."+t.dataset.contenedor).addClass("has-success").removeClass("has-error")}),this.$("select").each(function(a,t){0===t.value.length?e("."+t.dataset.contenedor).addClass("has-error"):e("."+t.dataset.contenedor).addClass("has-success").removeClass("has-error")})},enviar_form:function(){var e=this.$("#name").val(),a=this.$("#number").val(),t=this.$("#mes").val(),r=this.$("#year").val(),s=this.$("#cvc").val();e&&a&&t&&r&&s&&this.pago_Stripe(e,a,t,r,s)},pago_Stripe:function(a,t,r,i,o){var d=(new Loader,this),c=d.stripe_key;s.setPublishableKey(c);var u=function(a,t){var r=e("#pagar_tarjeta");if(t.error)r.find(".payment-errors").text(t.error.message),r.find("button").prop("disabled",!1);else{var s=t.id;r.append(e('<input type="hidden" name="stripeToken" />').val(s));var i=n;e.post("/pago/stripe/",{stripeToken:s,carro:i.id}).done(function(e){"paid"===e.status&&(window.location="/felicidades/"+e.pedido+"/")})}},l={number:t,cvc:o,exp_month:r,exp_year:i};s.card.createToken(l,u)}});return i});