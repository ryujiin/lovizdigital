define(["jquery","underscore","backbone","swig","../../views/procesar/direcciones","../../views/procesar/nueva_direccion","../../collections/ubigeos","../../collections/metodos_envio","../../views/procesar/metodos_envio"],function(e,i,o,t,s,n,d,a,c){"use strict";var r=o.View.extend({template:t.compile(e("#paso_metodoenvio_tlp").html()),tagName:"div",id:"",className:"",events:{"change input[name=selecion_direccion]":"mostrar_formulario","change #departamentos":"add_provincias","change #provincias":"add_distritos","click .btn-next":"siguiente_paso"},initialize:function(){this.listenTo(this.model,"change:paso_actual",this.render),this.listenTo(this.model,"change:direccion_envio",this.mostrar_metodo_envio),this.render()},render:function(){this.$el.html(this.template()),this.ver_estado()},rellenar:function(){new s({el:this.$(".direcciones"),collection:this.collection});this.$(".form_addDirec").hide(),this.$(".metodo_envio_form").hide()},ver_estado:function(){var e=this.model.toJSON().paso_actual;2===e&&(this.rellenar(),this.$el.addClass("is-activo")),e>2&&this.$el.addClass("is-guardado")},mostrar_metodo_envio:function(){new c({el:this.$(".metodo_envio_form .lista_metodos"),collection:new a});this.$(".metodo_envio_form").slideDown()},mostrar_formulario:function(){var e=this.$("input[type=radio]:checked").val();if("add_form"===e){{new n({el:this.$(".formulario"),model:this.model,collection:this.collection})}this.$(".form_addDirec").slideDown()}else this.$(".lista_metodos").empty(),this.$(".form_addDirec").slideUp(),this.model.set("direccion_envio",e)},siguiente_paso:function(){var e=this,i=this.$("input[name=selecion_direccion]:checked").val(),o=this.$("input[name=selecion_metodo]:checked").val();void 0!==i&&"add_form"!==i&&void 0!==o?(this.model.set({direccion_envio:i,metodoenvio:o}),this.model.save().done(function(){e.model.set("paso_actual",3)})):(void 0===i&&this.$(".error_direccion").fadeIn(),void 0===o&&this.$(".error_metodo").fadeIn())}});return r});